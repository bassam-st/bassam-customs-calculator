<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>البنود الجمركية</title>
<style>
  body{font-family:'Noto Kufi Arabic',system-ui,sans-serif;background:#f1f5f9;margin:0}
  .top{background:#16a34a;color:#fff;padding:14px 16px;font-size:18px;font-weight:700;text-align:center}
  .wrap{max-width:880px;margin:16px auto;padding:0 12px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05);padding:14px;margin-top:12px}
  input{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:12px;font-size:16px;background:#fff}
  .item{background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin-top:10px;display:flex;justify-content:space-between;align-items:center}
  .info{flex:1}
  .name{font-weight:700;color:#0f172a}
  .code{font-size:13px;color:#475569;margin-top:2px}
  .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-green{background:#16a34a;color:#fff}
  .muted{color:#64748b;font-size:13px}
  .nav a{display:inline-block;text-decoration:none;background:#e2e8f0;color:#0f172a;padding:8px 12px;border-radius:10px}
</style>
</head>
<body>
  <div class="top">📋 البنود الجمركية</div>
  <div class="wrap">
    <div class="nav"><a href="./index.html">← العودة للحاسبة</a></div>

    <div class="card">
      <input id="q" placeholder="اكتب اسم الصنف بالعربية... مثال: بطاريات، ملابس، رولات تغليف، شبك حديد" autofocus />
      <div class="muted" style="margin-top:6px">يمكنك البحث باسم الصنف بالعربية أو برقم البند الجمركي</div>
    </div>

    <div class="card" id="results">
      <div class="muted">ابدأ بالكتابة لعرض البنود...</div>
    </div>
  </div>

<script>
  const HS_URL = './assets/hs_catalog.json';
  let HS = [];

  // — تحميل البيانات —
  async function loadHS(){
    try{
      const res = await fetch(HS_URL);
      HS = await res.json();
    }catch{ HS = []; }
  }

  // — تطبيع الأحرف العربية —
  function normalizeArabic(s){
    if(!s) return "";
    return s.replace(/[أإآا]/g,'ا')
            .replace(/ى/g,'ي')
            .replace(/ة/g,'ه')
            .replace(/[^\u0600-\u06FF0-9a-zA-Z\s]+/g,' ')
            .trim();
  }

  function matches(item, query){
    const q = normalizeArabic(query);
    const name = normalizeArabic(item.name || '');
    const code = String(item.code || '');
    return name.includes(q) || code.startsWith(q);
  }

  function render(list, query){
    const box = document.getElementById('results');
    if(!list.length){
      box.innerHTML = '<div class="muted">لم يتم العثور على بنود مطابقة...</div>';
      return;
    }

    box.innerHTML = list.slice(0,200).map(x => `
      <div class="item">
        <div class="info">
          <div class="name">${x.name}</div>
          <div class="code">البند الجمركي: ${x.code}</div>
        </div>
        <button class="btn btn-green" onclick="goCalc('${x.code}')">استخدام</button>
      </div>
    `).join('');
  }

  function goCalc(code){
    location.href = './index.html?hs=' + code;
  }

  const q = document.getElementById('q');
  q.addEventListener('input', ()=>{
    const query = q.value.trim();
    const filtered = HS.filter(x => matches(x, query));
    render(filtered, query);
  });

  (async ()=>{
    await loadHS();
    render([], '');
  })();
</script>
</body>
</html>
