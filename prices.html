<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¥Ø¯Ø§Ø±Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ù„Ø¹ (USD)</title>
<style>
  body{font-family:'Noto Kufi Arabic',system-ui,sans-serif;background:#f1f5f9;margin:0}
  .top{background:#2563eb;color:#fff;padding:14px 16px;font-weight:800;text-align:center}
  .wrap{max-width:880px;margin:16px auto;padding:0 12px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05);padding:14px;margin-top:12px}
  label{display:block;font-size:13px;color:#475569;margin-bottom:4px}
  input,select,textarea{width:100%;padding:10px;border:1px solid #cbd5e1;border-radius:10px;background:#fff;font-size:14px}
  textarea{min-height:70px}
  .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-blue{background:#2563eb;color:#fff}
  .btn-green{background:#16a34a;color:#fff}
  .btn-gray{background:#e2e8f0;color:#0f172a}
  .btn-orange{background:#f97316;color:#fff}
  .btn-red{background:#ef4444;color:#fff}
  .list .item{display:flex;justify-content:space-between;gap:10px;padding:10px;border-bottom:1px dashed #cbd5e1;flex-wrap:wrap}
  .muted{color:#64748b;font-size:12px}
  .tag{display:inline-block;background:#eef2ff;color:#1e3a8a;border:1px solid #c7d2fe;padding:2px 8px;border-radius:999px;font-size:12px;margin-inline-start:6px}
</style>
</head>
<body>
  <div class="top">ğŸ’² Ø¥Ø¯Ø§Ø±Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø³Ù„Ø¹ (USD)</div>
  <div class="wrap">

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ -->
    <div class="card">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <span>ğŸ”’ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ:</span>
        <input id="pin" type="password" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø§Ù„Ùƒ (PIN)" />
        <button class="btn btn-blue" id="unlock">ÙØªØ­</button>
        <button class="btn btn-gray" id="lock">Ù‚ÙÙ„</button>
        <span id="ownerState" class="muted">Ø§Ù„Ø­Ø§Ù„Ø©: Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·</span>
      </div>
      <div class="muted" style="margin-top:6px">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¯ÙˆÙ† ÙØªØ­ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø§Ù„Ø­Ø°Ù Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø£Ùˆ Ø§Ù„ØªØµØ¯ÙŠØ±.
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ -->
    <div class="card" id="adminForm" style="display:none">
      <h3>â• Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø± Ø³Ù„Ø¹Ø©</h3>
      <div style="display:grid;grid-template-columns:1fr 150px 130px;gap:10px;max-width:880px">
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©</label>
          <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ø¨Ø·Ø§Ø±ÙŠØ§Øª Ù„ÙŠØ«ÙŠÙˆÙ… (Ah)" />
        </div>
        <div>
          <label>Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</label>
          <input id="price" type="number" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 3000" />
        </div>
        <div>
          <label>Ø§Ù„ÙˆØ­Ø¯Ø©</label>
          <select id="unit">
            <option value="ton">Ù„Ù„Ø·Ù†</option>
            <option value="kg">Ù„Ù„ÙƒÙŠÙ„Ùˆ</option>
            <option value="dz">Ù„Ù„Ø¯ÙØ²Ù’Ù†</option>
            <option value="pcs">Ù„Ù„Ø­Ø¨Ø©</option>
            <option value="ltr">Ù„Ù„ØªØ±</option>
            <option value="Ah">Ah (Ù„ÙƒÙ„ Ø£Ù…Ø¨ÙŠØ±/Ø³Ø§Ø¹Ø©)</option>
            <option value="kW">ÙƒÙŠÙ„ÙˆÙˆØ§Øª</option>
            <option value="W">ÙˆØ§Øª</option>
          </select>
        </div>
      </div>
      <div style="margin-top:10px">
        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <textarea id="notes" placeholder="Ù…Ø«Ø§Ù„: Ù…ØµØ¯Ø± Ø§Ù„Ø³Ø¹Ø±ØŒ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«..."></textarea>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
        <button class="btn btn-green" id="saveBtn">Ø§Ø­ÙØ¸/Ø­Ø¯Ù‘Ø«</button>
        <button class="btn btn-gray" id="clearBtn">ØªÙØ±ÙŠØº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
        <span class="muted" id="msg" style="display:none">âœ” ØªÙ… Ø§Ù„Ø­ÙØ¸</span>
      </div>
    </div>

    <!-- Ø£Ø¯ÙˆØ§Øª ÙˆØ§Ø³ØªØ¹Ø±Ø§Ø¶ -->
    <div class="card">
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="q" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…... Ù…Ø«Ø§Ù„: Ø¨Ø·Ø§Ø±ÙŠØ§ØªØŒ Ø´Ø¨ÙƒØŒ Ù…Ù„Ø§Ø¨Ø³" />
        <button class="btn btn-blue" id="exportBtn" disabled>ØªØµØ¯ÙŠØ± JSON</button>
        <button class="btn btn-gray" id="importBtn" disabled>Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
        <input type="file" id="importFile" accept="application/json" style="display:none" />
      </div>
      <div id="list" style="margin-top:10px"></div>
    </div>
  </div>

<script>
  const ADMIN_PIN = "bassam1234";
  let isOwner = false;
  const pin=document.getElementById('pin'),unlock=document.getElementById('unlock'),
        lock=document.getElementById('lock'),ownerState=document.getElementById('ownerState'),
        adminForm=document.getElementById('adminForm');
  function updateOwnerUI(){
    ownerState.textContent='Ø§Ù„Ø­Ø§Ù„Ø©: '+(isOwner?'Ù…Ø§Ù„Ùƒ (ØªØ­Ø±ÙŠØ± Ù…ÙØ¹Ù‘Ù„)':'Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·');
    adminForm.style.display=isOwner?'':'none';
    document.getElementById('exportBtn').disabled=!isOwner;
    document.getElementById('importBtn').disabled=!isOwner;
    render();
  }
  unlock.onclick=()=>{if(pin.value===ADMIN_PIN){isOwner=true;updateOwnerUI();alert('âœ… ØªÙ… ÙØªØ­ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ');}else alert('âŒ Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­');};
  lock.onclick=()=>{isOwner=false;updateOwnerUI();};

  const KEY='pricesCatalogV1';
  const nameEl=document.getElementById('name'),priceEl=document.getElementById('price'),
        unitEl=document.getElementById('unit'),notesEl=document.getElementById('notes'),
        saveBtn=document.getElementById('saveBtn'),clearBtn=document.getElementById('clearBtn'),
        msg=document.getElementById('msg'),q=document.getElementById('q'),list=document.getElementById('list'),
        exportBtn=document.getElementById('exportBtn'),importBtn=document.getElementById('importBtn'),
        importFile=document.getElementById('importFile');

  let baseData=[];
  async function loadBase(){
    try{const r=await fetch('./assets/prices_catalog.json');baseData=await r.json();}catch{baseData=[];}
  }
  function loadLocal(){try{return JSON.parse(localStorage.getItem(KEY))||[]}catch{return[]}}
  function saveLocal(arr){localStorage.setItem(KEY,JSON.stringify(arr));}
  function mergedData(){
    const local=loadLocal(),map=new Map();
    baseData.forEach(x=>map.set((x.name||'').trim(),x));
    local.forEach(x=>map.set((x.name||'').trim(),x));
    return Array.from(map.values());
  }
  function unitLabel(u){return u==='ton'?'Ù„Ù„Ø·Ù†':u==='kg'?'Ù„Ù„ÙƒÙŠÙ„Ùˆ':u==='dz'?'Ù„Ù„Ø¯ÙØ²Ù’Ù†':u==='pcs'?'Ù„Ù„Ø­Ø¨Ø©':u==='ltr'?'Ù„Ù„ØªØ±':u==='Ah'?'Ah/Ø£Ù…Ø¨ÙŠØ±':u==='kW'?'ÙƒÙŠÙ„ÙˆÙˆØ§Øª':u==='W'?'ÙˆØ§Øª':'';}
  function upsert(rec){if(!isOwner)return alert('Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·');const arr=loadLocal();const i=arr.findIndex(x=>(x.name||'')===rec.name);if(i>=0)arr[i]=rec;else arr.push(rec);saveLocal(arr);}
  function delItem(name){if(!isOwner)return alert('Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·');const arr=loadLocal().filter(x=>(x.name||'')!==name);saveLocal(arr);render();}
  function applyToForm(rec){nameEl.value=rec.name||'';priceEl.value=rec.price||'';unitEl.value=rec.unit||'ton';notesEl.value=rec.notes||'';window.scrollTo({top:adminForm.offsetTop-12,behavior:'smooth'});}
  window.applyToForm=applyToForm;window.delItem=delItem;
  function render(){
    const arr=mergedData();const s=(q.value||'').trim();const f=s?arr.filter(x=>(x.name||'').includes(s)):arr;
    if(!f.length){list.innerHTML='<div class="muted" style="padding:10px">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øªâ€¦</div>';return;}
    list.innerHTML=f.map(x=>`
    <div class="item">
      <div>
        <div><b>${x.name}</b> <span class="tag">${unitLabel(x.unit)}</span></div>
        <div class="muted">${x.price} USD ${x.notes?('â€¢ '+x.notes):''}</div>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn btn-green" onclick="location.href='./index.html?value=${encodeURIComponent(x.price)}'">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø³Ø¹Ø±</button>
        ${isOwner?`
        <button class="btn btn-orange" onclick="window.applyToForm(${JSON.stringify(x)})">ØªØ¹Ø¯ÙŠÙ„</button>
        <button class="btn btn-red" onclick="delItem(${JSON.stringify(x.name)})">Ø­Ø°Ù</button>`:''}
      </div>
    </div>`).join('');
  }

  saveBtn.onclick=()=>{if(!isOwner)return alert('Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·');const rec={name:(nameEl.value||'').trim(),price:+priceEl.value,unit:unitEl.value,notes:(notesEl.value||'').trim()};if(!rec.name)return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©');if(!rec.price)return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±');upsert(rec);msg.style.display='inline';setTimeout(()=>msg.style.display='none',1200);render();};
  clearBtn.onclick=()=>{nameEl.value='';priceEl.value='';unitEl.value='ton';notesEl.value='';};
  q.oninput=render;

  exportBtn.onclick=()=>{if(!isOwner)return alert('Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·');const data=JSON.stringify(mergedData(),null,2);const blob=new Blob([data],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='prices_catalog.json';a.click();};
  importBtn.onclick=()=>{if(!isOwner)return alert('Ù„Ù„Ù…Ø§Ù„Ùƒ ÙÙ‚Ø·');importFile.click();};
  importFile.onchange=async()=>{if(!isOwner)return;const f=importFile.files[0];if(!f)return;try{const t=await f.text();const a=JSON.parse(t);if(!Array.isArray(a))throw new Error('ØµÙŠØºØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©');saveLocal(a);render();alert('ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨Ù†Ø¬Ø§Ø­')}catch(e){alert('Ø®Ø·Ø£:'+e.message)}importFile.value='';};

  (async()=>{await loadBase();render();updateOwnerUI();})();
</script>
</body>
</html>
