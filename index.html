<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¨Ø³Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ</title>
<link rel="manifest" href="./manifest.json" />
<style>
  body{font-family:'Noto Kufi Arabic',system-ui,sans-serif;background:#f3f4f6;margin:0}
  .hero{background:#16a34a;color:#fff;padding:22px 16px;border-bottom-left-radius:28px;border-bottom-right-radius:28px}
  .wrap{max-width:920px;margin:-20px auto 24px;padding:0 12px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.06);padding:14px;margin-top:16px}
  .title{font-size:20px;margin:0 0 10px}
  label{display:block;margin:10px 0 6px;font-size:13px;color:#334155}
  input{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:10px;font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:640px){.row{grid-template-columns:1fr}}
  .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-green{background:#16a34a;color:#fff}
  .btn-blue{background:#2563eb;color:#fff}
  .btn-gray{background:#e2e8f0}
  .pill{display:flex;align-items:center;gap:8px;background:#e5f3e8;border-radius:999px;padding:10px 14px;user-select:none}
  .pills{display:flex;gap:10px;flex-wrap:wrap}
  .result{border:2px dashed #cbd5e1;border-radius:16px;padding:18px;text-align:center;margin-top:12px}
  .result b{font-size:42px;color:#065f46}
  .muted{color:#6b7280;font-size:13px}
  .top-buttons{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
</style>
</head>
<body>
  <div class="hero">
    <div class="wrap" style="color:#fff">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
        <div>
          <h1 style="margin:0 0 6px">Ø¨Ø³Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ</h1>
          <div class="muted" style="color:#e7ffe7">Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙˆØ®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ®Ù„ÙŠØµ: 009677719997809</div>
        </div>
        <div class="top-buttons">
          <a class="btn btn-blue" href="./prices.html" style="text-decoration:none">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ğŸ’²</a>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ -->
    <div class="card">
      <div class="row" style="align-items:end">
        <div>
          <label>ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ: PIN</label>
          <input id="pin" placeholder="PIN" />
          <div class="muted" id="state">Ø§Ù„Ø­Ø§Ù„Ø©: Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·</div>
        </div>
        <div style="display:flex;gap:10px">
          <button class="btn btn-blue" id="unlock">ÙØªØ­</button>
          <button class="btn btn-gray" id="lock">Ù‚ÙÙ„</button>
        </div>
      </div>
      <div class="muted">Ø§Ù„ÙØ¦Ø© ØªØ¨Ù‚Ù‰ Ù…Ù‚ÙÙˆÙ„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…. ÙÙ‚Ø· Ø§Ù„Ù…Ø§Ù„Ùƒ ÙŠÙ…ÙƒÙ†Ù‡ ØªØºÙŠÙŠØ±Ù‡Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ â€œÙØªØ­â€.</div>
    </div>

    <!-- Ø§Ù„Ø­Ø§Ø³Ø¨Ø© -->
    <div class="card">
      <h3 class="title">Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</h3>

      <div class="row">
        <div>
          <label>Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙˆØ­Ø¯Ø© (USD)</label>
          <input id="unitPrice" type="number" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 15" />
        </div>
        <div>
          <label>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</label>
          <input id="qty" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 20" />
        </div>
      </div>

      <div style="margin-top:8px">
        <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ù„Ø¹Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (USD)</label>
        <input id="usd" placeholder="ÙŠÙØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ = Ø³Ø¹Ø± Ã— Ø¹Ø¯Ø¯ (ÙŠÙ…ÙƒÙ† Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§)" />
      </div>

      <div class="row" style="margin-top:8px">
        <div>
          <label>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù (Ø±ÙŠØ§Ù„/Ø¯ÙˆÙ„Ø§Ø±)</label>
          <input id="fxInput" type="number" inputmode="decimal" value="750" />
        </div>
        <div>
          <label>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„</label>
          <input id="factorInput" type="number" inputmode="decimal" value="0.2075" />
        </div>
      </div>

      <div style="margin-top:10px">
        <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©</label>
        <div class="pills" id="rateGroup">
          <label class="pill">
            <input type="radio" name="rate" value="0.05" /> 5%
          </label>
          <label class="pill">
            <input type="radio" name="rate" value="0.10" /> 10%
          </label>
        </div>
      </div>

      <div class="result">
        <div class="muted">Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ© (Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ)</div>
        <b id="out">0</b>
        <div class="muted" id="formula" style="margin-top:6px">0 = 0.2075 Ã— 750 Ã— 0</div>
      </div>

      <div class="top-buttons" style="justify-content:center;margin-top:12px">
        <button class="btn btn-blue" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF</button>
        <button class="btn btn-green" onclick="copyResult()">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
      </div>
    </div>
  </div>

<script>
  // ======== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©
  const ADMIN_PIN = 'bassam1234';
  let isOwner = false;

  const pinEl = document.getElementById('pin');
  const unlockBtn = document.getElementById('unlock');
  const lockBtn = document.getElementById('lock');
  const stateEl = document.getElementById('state');

  function setOwnerUI(){
    stateEl.textContent = 'Ø§Ù„Ø­Ø§Ù„Ø©: ' + (isOwner ? 'Ù…Ø§Ù„Ùƒ (ØªØ­Ø±ÙŠØ± Ù…ÙØ¹Ù‘Ù„)' : 'Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·');
    // Ù‚ÙÙ„/ÙØªØ­ Ø§Ù„ÙØ¦Ø©
    document.querySelectorAll('input[name="rate"]').forEach(r => r.disabled = !isOwner);
  }
  unlockBtn.addEventListener('click', ()=>{
    if(pinEl.value===ADMIN_PIN){ isOwner=true; setOwnerUI(); alert('âœ… ØªÙ… ÙØªØ­ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ'); }
    else alert('âŒ Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­');
  });
  lockBtn.addEventListener('click', ()=>{ isOwner=false; setOwnerUI(); });

  // ======== Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
  const unitPrice = document.getElementById('unitPrice');
  const qty       = document.getElementById('qty');
  const usdInput  = document.getElementById('usd');
  const fxInput   = document.getElementById('fxInput');
  const factorInp = document.getElementById('factorInput');
  const rateRadios= Array.from(document.querySelectorAll('input[name="rate"]'));
  const outEl     = document.getElementById('out');
  const formulaEl = document.getElementById('formula');

  function fmt(n){ return new Intl.NumberFormat('en-US').format(Math.round(n||0)); }
  function fmtYer(n){ try{ return new Intl.NumberFormat('ar-YE',{maximumFractionDigits:0}).format(Math.round(n||0)); } catch{ return fmt(n);} }

  function getRate(){
    const r = rateRadios.find(x=>x.checked);
    return r ? parseFloat(r.value) : 0.10;
  }

  function calcTotalUSD(){
    const u = parseFloat(unitPrice.value||'0');
    const q = parseFloat(qty.value||'0');
    if (u>0 && q>0) usdInput.value = String(u*q);
  }

  function calc(){
    const usd = parseFloat(usdInput.value||'0');
    const fx  = parseFloat(fxInput.value||'750') || 750;
    const fac = parseFloat(factorInp.value||'0.2075') || 0.2075;
    const rate= getRate();
    const duty = usd * fx * fac * rate;
    outEl.textContent = fmtYer(duty);
    formulaEl.textContent = `${fmt(usd)} = ${fac} Ã— ${fmt(fx)} Ã— ${fmt(usd)} Ã— ${rate}`;
  }

  [unitPrice, qty].forEach(el=> el.addEventListener('input', ()=>{ calcTotalUSD(); calc(); }));
  [usdInput, fxInput, factorInp].forEach(el=> el.addEventListener('input', calc));
  rateRadios.forEach(r=> r.addEventListener('change', calc));

  // ======== Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ø±Ø§Ù…ØªØ±Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· (Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±)
  (function fromQuery(){
    const url = new URL(location.href);
    const price = url.searchParams.get('price'); // Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©
    const unit  = url.searchParams.get('unit');  // Ù„Ø§ Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù‡Ù†Ø§ Ù„ÙƒÙ† Ù…Ø­ÙÙˆØ¸ Ù„Ùˆ Ø£Ø±Ø¯Øª Ø¹Ø±Ø¶Ù‡
    const qtyQ  = url.searchParams.get('qty') || '1';
    const rateQ = url.searchParams.get('rate');  // "5" Ø£Ùˆ "10"

    if (price){ unitPrice.value = price; }
    if (qtyQ){  qty.value = qtyQ; }
    calcTotalUSD();

    // ÙØ±Ø¶ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© + Ù‚ÙÙ„Ù‡Ø§ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if (rateQ === '5' || rateQ === '10') {
      const v = rateQ === '5' ? '0.05' : '0.10';
      const radio = rateRadios.find(r=> r.value===v);
      if (radio) radio.checked = true;
    } else {
      // Ø§ÙØªØ±Ø§Ø¶ÙŠ 10% Ø¥Ù† Ù„Ù… ÙŠØ£ØªÙ Ø´ÙŠØ¡
      const r10 = rateRadios.find(r=> r.value==='0.10'); if (r10) r10.checked = true;
    }

    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ ØªØºÙŠÙŠØ± Ø§Ù„ÙØ¦Ø© (ØªÙÙØªØ­ ÙÙ‚Ø· Ø¨ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ)
    isOwner = false;
    setOwnerUI();
    calc();
  })();

  // ======== Ø£Ø¯ÙˆØ§Øª
  function copyResult(){
    const text = `Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©: ${outEl.textContent} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ\n${formulaEl.textContent}`;
    navigator.clipboard.writeText(text).then(()=>alert('âœ” ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
  }
  window.copyResult = copyResult;
</script>
</body>
</html>
