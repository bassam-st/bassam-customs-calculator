<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø¨Ø³Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ</title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#16a34a">
  <link rel="icon" href="/icons/icon-192.png">

  <style>
    :root{
      --green:#16a34a; --green2:#22c55e; --ink:#0f172a; --muted:#64748b;
      --card:#ffffff; --bg:#f1f5f9; --accent:#2563eb;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:'Noto Kufi Arabic',system-ui,sans-serif;color:var(--ink)}
    .wrap{max-width:720px;margin:16px auto;padding:12px}

    .hero{
      background:linear-gradient(135deg,var(--green),var(--green2));
      color:#fff;border-radius:24px;padding:22px 18px;position:relative;
      box-shadow:0 10px 30px rgba(22,163,74,.18);
    }
    .brand{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand h1{margin:0;font-size:22px;line-height:1.35}
    .badge{
      background:#fff;border:2px solid #fff;color:#064e3b;
      width:64px;height:64px;display:grid;place-items:center;border-radius:18px;
      font-weight:800;font-size:22px
    }
    .phone{margin-top:6px;opacity:.95;font-size:14px}
    .nav{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 0}
    .nav a{background:#e2e8f0;color:#0f172a;text-decoration:none;padding:8px 12px;border-radius:10px;font-weight:700}

    .card{background:var(--card);border-radius:18px;padding:16px;margin-top:16px;
          box-shadow:0 8px 24px rgba(0,0,0,.06);border:1px solid #e5e7eb}
    .owner{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .owner small{color:var(--muted)}
    .owner input[type=password]{padding:10px 12px;border:1px solid #cbd5e1;border-radius:10px}
    .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
    .btn-blue{background:var(--accent);color:#fff}
    .btn-gray{background:#e2e8f0;color:#0f172a}
    .owner-on{color:#065f46;font-weight:800}

    label{display:block;font-weight:700;margin-bottom:6px}
    input[type="number"]{
      width:100%;padding:14px 16px;border:1px solid #cbd5e1;border-radius:14px;
      font-size:18px;background:#fff;outline:none
    }
    .group-title{margin:16px 0 8px;font-weight:700;color:#334155}
    .rates{display:flex;flex-direction:column;gap:12px}
    .pill{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:14px;border-radius:999px;border:2px solid #cbead9;
      background:#f0fdf4;cursor:pointer
    }
    .pill input{appearance:none;width:22px;height:22px;border:2px solid #84d1b0;border-radius:50%;margin:0}
    .pill.active{background:#14532d;color:#fff;border-color:#14532d}
    .pill.active input{border-color:#fff;box-shadow:inset 0 0 0 6px #fff;background:#fff}
    .hint{font-size:13px;color:#0f5132;opacity:.9}
    .result{
      border:2px dashed #cbd5e1;border-radius:18px;padding:18px;background:#f8fafc;margin-top:8px;
      text-align:center
    }
    .result .big{font-size:42px;font-weight:900;color:#065f46;letter-spacing:1px}
    .result .mini{margin-top:8px;color:var(--muted)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:16px}
    .btn.copy{background:#22c55e;color:#fff}
    .btn.pdf{background:var(--accent);color:#fff}
    .btn.wa{background:#16a34a;color:#fff}
    @media (max-width:420px){ .result .big{font-size:36px} }

    #installBtn{
      position:fixed; bottom:16px; inset-inline:16px; z-index:9999;
      background:#16a34a; color:#fff; border:none; border-radius:14px;
      padding:12px 16px; font-weight:900; display:none; box-shadow:0 8px 20px rgba(22,163,74,.25);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <div class="brand">
        <h1>Ø¨Ø³Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ</h1>
        <div class="badge">ğŸ’¼</div>
      </div>
      <div class="phone">Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙˆØ®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ®Ù„ÙŠØµ: <b>00967771997809</b></div>
      <div class="nav">
        <a href="./prices.html">ğŸ’² Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a>
        <a href="./hs.html">ğŸ” Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©</a>
      </div>
    </section>

    <section class="card">
      <label for="usd">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ù„Ø¹Ø© (Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± USD)</label>
      <input id="usd" type="number" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 2000" />

      <div class="group-title">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©</div>
      <div class="rates">
        <label class="pill" id="pill5">
          <div><b>5%</b> <span class="hint">(ÙØ¦Ø© Ø®Ù…Ø³Ø© Ø¨Ø§Ù„Ù…Ø¦Ø©)</span></div>
          <input type="radio" name="rate" value="0.2075" />
        </label>
        <label class="pill active" id="pill10">
          <div><b>10%</b> <span class="hint">(ÙØ¦Ø© Ø¹Ø´Ø±Ø© Ø¨Ø§Ù„Ù…Ø¦Ø©)</span></div>
          <input type="radio" name="rate" value="0.265" checked />
        </label>
      </div>

      <div class="group-title">Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ© (Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ)</div>
      <div class="result">
        <div class="big" id="out">0</div>
        <div class="mini" id="formula">0 Ã— 750 Ã— 0 = 0</div>
      </div>

      <div class="actions">
        <button class="btn pdf"  onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø© / Ø­ÙØ¸ PDF</button>
        <button class="btn copy" onclick="copyResult()">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
        <button class="btn wa"   onclick="shareWhatsApp()">Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</button>
      </div>
    </section>
  </div>

  <button id="installBtn">â¤µï¸ ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</button>

<script>
  // PWA
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js?v=2').catch(console.error);
  }
  let deferredPrompt=null; const installBtn=document.getElementById('installBtn');
  window.addEventListener('beforeinstallprompt',(e)=>{e.preventDefault();deferredPrompt=e;installBtn.style.display='block';});
  installBtn.addEventListener('click',async()=>{if(!deferredPrompt)return;installBtn.style.display='none';deferredPrompt.prompt();await deferredPrompt.userChoice;deferredPrompt=null;});

  // Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
  const usd   = document.getElementById('usd');
  const out   = document.getElementById('out');
  const formula = document.getElementById('formula');
  const rateRadios = Array.from(document.querySelectorAll('input[name="rate"]'));
  const pills = [document.getElementById('pill5'), document.getElementById('pill10')];
  const enFmt = new Intl.NumberFormat('en-US');

  rateRadios.forEach((r,i)=>{
    r.addEventListener('change',()=>{
      pills.forEach(p=>p.classList.remove('active'));
      pills[i].classList.add('active');
      calc();
    });
  });
  usd.addEventListener('input', calc);

  function getRate(){
    const r = rateRadios.find(x=>x.checked);
    return r ? parseFloat(r.value) : 0.2075;
  }

  function calc(){
    const v = parseFloat(usd.value || 0);
    const rate = getRate();
    const result = v * 750 * rate;
    out.textContent = enFmt.format(Math.round(result));
    const f = `${enFmt.format(v)} Ã— 750 Ã— ${rate} = ${enFmt.format(Math.round(result))}`;
    formula.textContent = f;
  }

  // Ù†Ø³Ø®/ÙˆØ§ØªØ³Ø§Ø¨
  function copyResult(){
    const text = `Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©: ${out.textContent} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ`;
    navigator.clipboard.writeText(text).then(()=>alert('âœ” ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
  }
  function shareWhatsApp(){
    const msg = `Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©: ${out.textContent} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ`;
    open(`https://wa.me/?text=${encodeURIComponent(msg)}`,'_blank');
  }
  window.copyResult = copyResult;
  window.shareWhatsApp = shareWhatsApp;

  // âœ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø³Ø¹Ø± ÙˆØ§Ù„ÙƒÙ…ÙŠØ© ÙˆØ§Ù„ÙØ¦Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
  (function applyFromQuery(){
    try{
      const q = new URLSearchParams(location.search);
      const price = parseFloat(q.get('price') || q.get('usd') || '0'); // Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±/Ø­Ø¨Ø©/Ø·Ù†â€¦
      const qty   = parseFloat(q.get('qty') || '1');                   // Ø¹Ø¯Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      const rateMul = parseFloat(q.get('rateMul') || q.get('rate') || ''); // 0.2075 Ø£Ùˆ 0.265
      const ratePct = parseFloat(q.get('ratePct') || '');                 // 5 Ø£Ùˆ 10

      if (price > 0) {
        const totalUSD = price * (isFinite(qty)&&qty>0 ? qty : 1);
        usd.value = String(totalUSD);
      }

      // Ø§Ø¶Ø¨Ø· Ø§Ù„ÙØ¦Ø© Ø¥Ù† ØªÙ… ØªÙ…Ø±ÙŠØ±Ù‡Ø§
      const setRadioByValue = (valStr)=>{
        const r = rateRadios.find(x=>x.value === valStr);
        if (r){
          r.checked = true;
          const idx = rateRadios.indexOf(r);
          pills.forEach(p=>p.classList.remove('active'));
          if (pills[idx]) pills[idx].classList.add('active');
        }
      };
      if (!isNaN(rateMul) && (rateMul===0.2075 || rateMul===0.265)) {
        setRadioByValue(String(rateMul));
      } else if (!isNaN(ratePct)) {
        setRadioByValue(ratePct===5 ? '0.2075' : ratePct===10 ? '0.265' : '0.265');
      }

      calc();
      if (location.search) history.replaceState({}, '', location.pathname); // Ù†Ø¸Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø·
    }catch(e){}
  })();

  // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
  calc();
</script>

<!-- âœ… ØªØªØ¨Ù‘ÙØ¹ Inline (Ù„Ø§ ÙŠØºÙŠÙ‘Ø± Ø£ÙŠ Ø³Ù„ÙˆÙƒ Ù…Ø±Ø¦ÙŠ) -->
<script>
(function(){
  const TRACK_URL="https://bassam-tracker.onrender.com/track";
  function uuid(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,c=>{
    const r=crypto.getRandomValues(new Uint8Array(1))[0]&15,v=c==='x'?r:(r&3|8);return v.toString(16);
  });}
  const LS=localStorage; let deviceId=LS.getItem("deviceId"); if(!deviceId){deviceId=uuid();LS.setItem("deviceId",deviceId);}
  async function send(event,payload){
    const body=JSON.stringify({event,deviceId,payload:payload||{}});
    try{
      if(navigator.sendBeacon){navigator.sendBeacon(TRACK_URL,new Blob([body],{type:"application/json"}));}
      else{await fetch(TRACK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body});}
    }catch(_){}
  }
  document.addEventListener("DOMContentLoaded",()=>send("page_view",{path:location.pathname,title:document.title}));
  document.addEventListener("submit",(e)=>{try{
    const f=e.target; const q=f.querySelector('input[type="search"],[name*="search"],[id*="search"],[name*="query"],[id*="query"]');
    const val=q?String(q.value||"").trim():""; if(val) send("search",{q:val,page:location.pathname});
  }catch(_){ }},true);
  window.trackSearch=(q)=>send("search",{q:String(q||"").trim(),page:location.pathname});
})();
</script>
</body>
</html>
