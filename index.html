<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©</title>
<style>
  body{font-family:'Noto Kufi Arabic',system-ui,sans-serif;background:#f1f5f9;margin:0}
  .top{background:#16a34a;color:#fff;padding:16px;text-align:center;font-weight:800}
  .wrap{max-width:880px;margin:16px auto;padding:0 12px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.05);padding:14px;margin-top:12px}
  label{display:block;font-size:13px;color:#475569;margin:6px 0 4px}
  input{width:100%;padding:12px;border:1px solid #cbd5e1;border-radius:12px;font-size:16px;background:#fff}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  .btn-green{background:#16a34a;color:#fff}
  .btn-gray{background:#e2e8f0}
  .res{font-size:40px;font-weight:800;color:#065f46;text-align:center}
  .muted{color:#64748b;font-size:12px}
  .pill{padding:10px;border-radius:999px;border:1px solid #cbd5e1;display:flex;align-items:center;gap:8px;justify-content:space-between}
  .pill.locked{opacity:.6;pointer-events:none}
  .row2{display:flex;gap:10px;flex-wrap:wrap}
  .nav a{display:inline-block;text-decoration:none;background:#e2e8f0;color:#0f172a;padding:8px 12px;border-radius:10px}
</style>
</head>
<body>
  <div class="top">ğŸ“¦ Ø¨Ø³Ù‘Ø§Ù… Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠ â€“ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</div>
  <div class="wrap">

    <div class="nav"><a href="./prices.html">â† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</a> <a href="./hs.html">Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©</a></div>

    <div class="card">
      <div class="row">
        <div>
          <label>Ø§Ø³Ù… Ø§Ù„Ø³Ù„Ø¹Ø©</label>
          <input id="name" placeholder="Ø§Ø®ØªÙŠØ§Ø±ÙŠ â€” ÙŠÙÙ…Ù„Ø£ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ù‚Ø¯ÙˆÙ… Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø±" />
        </div>
        <div>
          <label>Ø§Ù„ÙˆØ­Ø¯Ø©</label>
          <input id="unit" placeholder="Ù…Ø«Ø§Ù„: Ù„Ù„Ø­Ø¨Ø© / Ù„Ù„Ø·Ù†" />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Ø§Ù„Ø³Ø¹Ø± Ù„Ù„ÙˆØ­Ø¯Ø© (USD)</label>
          <input id="unitPrice" type="number" inputmode="decimal" placeholder="Ù…Ø«Ø§Ù„: 15" />
        </div>
        <div>
          <label>Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„ÙƒÙ„ÙŠ</label>
          <input id="qty" type="number" inputmode="numeric" placeholder="Ù…Ø«Ø§Ù„: 20" value="1" />
        </div>
      </div>

      <div>
        <label>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ù„Ø¹Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© (USD)</label>
        <input id="usdTotal" placeholder="ÙŠÙØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ = Ø³Ø¹Ø± Ã— Ø¹Ø¯Ø¯ â€” ÙˆÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ù„Ùˆ Ø£Ø±Ø¯Øª" />
        <div class="muted">Ø¥Ø°Ø§ ÙƒØªØ¨Øª Ù‡Ù†Ø§ ÙŠØ¯ÙˆÙŠÙ‹Ø§ Ø³ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø³Ø¨Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©.</div>
      </div>

      <div class="row">
        <div>
          <label>Ø³Ø¹Ø± Ø§Ù„ØµØ±Ù (Ø±ÙŠØ§Ù„/Ø¯ÙˆÙ„Ø§Ø±)</label>
          <input id="fx" type="number" inputmode="decimal" value="750" />
        </div>
        <div>
          <label>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©</label>
          <div id="rateBox" class="pill locked">
            <span id="rateLabel">â€”</span>
            <input id="rateValue" type="hidden" value="0.05" />
            <small class="muted">Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© ØªÙØ­Ø¯Ù‘Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ù…Ù‚ÙÙˆÙ„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…)</small>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="res" id="out">0</div>
      <div class="muted" id="formula">0 = 0 Ã— 750 Ã— 0</div>
      <div class="row2" style="margin-top:10px">
        <button class="btn btn-green" onclick="copyResult()">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
        <button class="btn btn-gray" onclick="shareWhatsApp()">Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨</button>
      </div>
    </div>
  </div>

<script>
  // â€”â€” Helpers â€”â€”
  const $ = id => document.getElementById(id);
  const enFmt = new Intl.NumberFormat('en-US');

  function normalizeArabicDigits(s=""){
    return String(s).replace(/[Ù -Ù©]/g, d => "0123456789"["Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§Ù¨Ù©".indexOf(d)] ?? d);
  }
  function extractRate(text=""){
    const t = normalizeArabicDigits(text).replace(/\s/g,'');
    // ÙŠØ¯Ø¹Ù…: Ø§Ù„ÙØ¦Ø©5% ØŒ Ø§Ù„ÙØ¦Ù‡10% ØŒ 5% ØŒ rate:5% â€¦
    const m = t.match(/(\d{1,2})\s*%/);
    if (m) {
      const n = parseInt(m[1],10);
      if (n===5) return 0.05;
      if (n===10) return 0.10;
    }
    return null; // ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©
  }
  function formatYER(n){
    try { return new Intl.NumberFormat('ar-YE',{maximumFractionDigits:0}).format(Math.round(n)); }
    catch { return Math.round(n).toLocaleString(); }
  }
  function setRateUIFromNumber(r){
    $('#rateValue').value = r;
    $('#rateLabel').textContent = (r===0.05?'5%':r===0.10?'10%': (Math.round(r*100)+'%'));
  }

  // â€”â€” Ù‚Ø±Ø§Ø¡Ø© Ø¨Ø§Ø±Ø§Ù…ÙŠØªØ±Ø§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¹Ø§Ø± â€”â€”
  const params = new URLSearchParams(location.search);
  const name  = params.get('name') || '';
  const unit  = params.get('unit') || '';
  const price = parseFloat(params.get('price')||'');
  const rateP = params.get('rate'); // '5' Ø£Ùˆ '10' Ù„Ùˆ ÙˆØµÙ„Øª
  const note  = params.get('note') || '';

  if (name) $('#name').value = name;
  if (unit) $('#unit').value = unit;
  if (!isNaN(price)) $('#unitPrice').value = price;

  // Ø§Ù„ÙØ¦Ø©: Ø£ÙˆÙ„ÙˆÙŠØ© (rateP) Ø«Ù… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§ØªØŒ ÙˆØ¥Ù† Ù„Ù… ØªÙˆØ¬Ø¯ Ù„Ø§ Ù†Ø­Ø¯Ø¯
  let rateAuto = null;
  if (rateP && !isNaN(parseFloat(rateP))) {
    rateAuto = parseFloat(rateP)/100;
  } else {
    const rFromNote = extractRate(note);
    if (rFromNote!==null) rateAuto = rFromNote;
  }
  if (rateAuto!==null) {
    setRateUIFromNumber(rateAuto);
  } else {
    // Ø¥Ù† Ù„Ù… Ù†Ø¬Ø¯ Ø´ÙŠØ¦Ù‹Ø§ØŒ Ù„Ø§ Ù†Ø¬Ø¨Ø± ÙØ¦Ø©: ØªØ¨Ù‚Ù‰ â€œâ€”â€ ÙˆÙ‚ÙŠÙ…Ø© 0
    $('#rateValue').value = 0;
    $('#rateLabel').textContent = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©';
  }

  // â€”â€” Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ù‚ÙˆÙ„ â€”â€”
  function currentUSD(){
    const manual = parseFloat($('#usdTotal').value||'');
    if (!isNaN(manual) && manual>0) return manual;
    const up = parseFloat($('#unitPrice').value||'0') || 0;
    const q  = parseFloat($('#qty').value||'0') || 0;
    return up*q;
  }
  function calc(){
    const usd = currentUSD();
    const fx  = parseFloat($('#fx').value||'750') || 750;
    const rate= parseFloat($('#rateValue').value||'0') || 0;
    const duty = usd * fx * rate;
    $('#out').textContent = formatYER(duty);
    $('#formula').textContent = `${enFmt.format(Math.round(duty))} = ${rate} Ã— ${enFmt.format(fx)} Ã— ${enFmt.format(usd)}`;
  }

  ['unitPrice','qty','usdTotal','fx'].forEach(id => { $('#'+id).addEventListener('input', calc); });

  // Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§
  calc();

  // â€” Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© â€”
  function copyResult(){
    const txt = `Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©: ${$('#out').textContent} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ\n${$('#formula').textContent}`;
    navigator.clipboard.writeText(txt).then(()=>alert('âœ” ØªÙ… Ø§Ù„Ù†Ø³Ø®'));
  }
  function shareWhatsApp(){
    const msg = `Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¬Ù…Ø±ÙƒÙŠØ©: ${$('#out').textContent} Ø±ÙŠØ§Ù„ ÙŠÙ…Ù†ÙŠ\n${$('#formula').textContent}`;
    open('https://wa.me/?text='+encodeURIComponent(msg),'_blank');
  }
  window.copyResult = copyResult;
  window.shareWhatsApp = shareWhatsApp;
</script>
</body>
</html>
